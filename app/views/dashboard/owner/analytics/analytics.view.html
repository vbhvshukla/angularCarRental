<div class="analytics-container" ng-controller="OwnerAnalyticsController as vm" ng-init="vm.init()">
    <div class="analytics-header">
        <h2>Analytics Dashboard</h2>
        <select ng-model="vm.selectedDays" ng-change="vm.updateTimeRange()" class="time-range-select">
            <option value="7">Last 7 days</option>
            <option value="30">Last 30 days</option>
            <option value="90">Last 90 days</option>
            <option value="180">Last 6 months</option>
        </select>
    </div>

    <div class="totals-grid">
        <div class="total-card">
            <h3>Total Revenue</h3>
            <p>{{vm.totals.formattedRevenue}}</p>
            <span class="trend" ng-class="vm.getTrend(vm.totals.totalRevenue, vm.totals.previousRevenue)">
                <i class="fas"
                    ng-class="{'fa-arrow-up': vm.getTrend(vm.totals.totalRevenue, vm.totals.previousRevenue) === 'up', 
                                        'fa-arrow-down': vm.getTrend(vm.totals.totalRevenue, vm.totals.previousRevenue) === 'down'}"></i>
            </span>
        </div>
        <div class="total-card">
            <h3>Total Bookings</h3>
            <p>{{vm.totals.totalBookings}}</p>
        </div>
        <div class="total-card">
            <h3>Total Cars</h3>
            <p>{{vm.totals.totalCars}}</p>
        </div>
    </div>

    <div class="charts-grid">
        <div class="chart-card">
            <h3>Monthly Revenue</h3>
            <canvas id="monthlyRevenueChart"></canvas>
        </div>

        <div class="chart-card">
            <h3>Bookings per Car</h3>
            <canvas id="bookingsPerCarChart"></canvas>
        </div>

        <div class="chart-card">
            <h3>Car Utilization</h3>
            <canvas id="carUtilizationChart"></canvas>
        </div>

        <div class="chart-card">
            <h3>Most Active Renters</h3>
            <canvas id="activeRentersChart"></canvas>
        </div>

        <div class="chart-card">
            <h3>Average Revenue per Booking</h3>
            <canvas id="avgRevenueChart"></canvas>
        </div>

        <div class="chart-card">
            <h3>Revenue by Type (Local/Outstation)</h3>
            <canvas id="revenueByTypeChart"></canvas>
        </div>

        <div class="chart-card">
            <h3>Average Revenue Trends</h3>
            <canvas id="avgRevenueTrendsChart"></canvas>
        </div>

        <div class="chart-card">
            <h3>Average Bid Amount per Car</h3>
            <canvas id="avgBidAmountChart"></canvas>
        </div>
    </div>

    <div class="loading-overlay" ng-if="vm.loading">
        <div class="spinner"></div>
    </div>
</div>
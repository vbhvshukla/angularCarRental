<div class="ownerdashboardhomecontent" ng-init="vm.init()" ng-controller="OwnerHomeDashboardController as vm" style="width: 100%; padding: 10px; background-color: #fff; border-radius: 8px; min-height: 450px; display: flex; flex-direction: column; justify-content: space-between;">
    <div class="extra-modal" ng-if="vm.showAddKmModal" style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div class="extra-modal-content" style="background-color: #fff; border-radius: 5px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); width: 50%; max-width: 600px;">
            <div class="extra-modal-header" style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; font-size: 1.5em;">Add Kms / Hrs</h2>
                <button type="button" class="close" ng-click="vm.closeAddKmModal()" style="background: none; border: none; font-size: 2em; cursor: pointer; color: #aaa; padding: 0;">&times;</button>
            </div>
            <div class="extra-modal-body" style="padding: 20px;">
                <form name="addExtras" ng-submit="vm.addExtras()" class="extras-form" style="display: flex; flex-direction: column; gap: 15px;">
                    <label for="extraKm" style="font-weight: bold; margin-bottom: 5px;">Additional Kilometers Driven</label>
                    <input type="number" name="extrakm" ng-model="vm.extras.extraKm" ng-minlength="0" ng-required style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; width: 100%; box-sizing: border-box;" /><br>
                    <label for="extraHr" style="font-weight: bold; margin-bottom: 5px;">Additional Hours Driven</label>
                    <input type="number" name="extrahr" ng-model="vm.extras.extraHr" ng-minlength="0" ng-required style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; width: 100%; box-sizing: border-box;" />
                    <div ng-if="vm.booking.rentalType === 'outstation'">
                        <label for="extraDay" style="font-weight: bold; margin-bottom: 5px;">Additional Days Driven</label>
                        <input type="number" name="extraday" ng-model="vm.extras.extraDay" ng-minlength="0" ng-required style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; width: 100%; box-sizing: border-box;" />
                    </div>
                    <span ng-show="myForm.extrakm.$error.required && myForm.extrakm.$touched" style="color: red; font-size: 0.8em;">Additional Kilometers is required.</span>
                    <span ng-show="myForm.extrahr.$error.required && myForm.extrahr.$touched" style="color: red; font-size: 0.8em;">Additional Hours is required.</span>
                    <button type="submit" ng-disabled="myForm.$invalid" style="background-color: #4CAF50; border: none; color: white; padding: 10px 20px; text-align: center; text-decoration: none; display: inline-block; font-size: 1em; cursor: pointer; border-radius: 4px; align-self: flex-start;">Submit</button>
                </form>
            </div>
        </div>
    </div>

    <h3>Pending Bids</h3>
    <div class="select-container">
        <select ng-model="vm.filters.pendingType" ng-change="vm.applyFilters()" style="margin-left: 10px; padding: 5px; font-size: 12px; border: 1px solid #bdc3c7; border-radius: 5px; background-color: white; cursor: pointer;">
            <option value="all">All</option>
            <option value="local">Local</option>
            <option value="outstation">Outstation</option>
        </select>
    </div>
    <div class="table-responsive" style="overflow-x: auto; max-width: 1200px;">
        <table id="pending-bids-table" class="table table-hover" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <thead>
                <tr>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Car Name</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Bid Amount</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Total Amount</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">User</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">From</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">To</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Rental Type</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="bid in vm.getPaginatedData(vm.filteredPendingBids, vm.pagination.pendingBids)" style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">
                    <td>{{bid.car.carName}}</td>
                    <td>{{bid.bidAmount | price}}</td>
                    <td>{{bid.bidBaseFare | price}}</td>
                    <td>{{bid.user.username}}</td>
                    <td>{{bid.fromTimestamp | date:'MM/dd/yyyy HH:mm'}}</td>
                    <td>{{bid.toTimestamp | date:'MM/dd/yyyy HH:mm'}}</td>
                    <td>{{bid.rentalType}}</td>
                    <td class="action-buttons" style="display: flex; gap: 10px;">
                        <button ng-click="vm.acceptBid(bid)" ng-disabled="vm.isProcessing && vm.processingBidId === bid.bidId" class="accept-btn" style="font-size: 13px; background: linear-gradient(135deg, #28a745, #218838); color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; transition: background 0.3s, transform 0.2s;">
                            {{vm.isProcessing ? 'Processing...' : 'Accept'}}
                        </button>
                        <button ng-click="vm.rejectBid(bid)" class="reject-btn" style="font-size: 13px; background: linear-gradient(135deg, #d9534f, #c9302c); color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; transition: background 0.3s, transform 0.2s;">
                            Reject
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="pagination" ng-if="vm.shouldShowPagination('pendingBids')" style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin: 1rem 0; text-align: center;">
        <button ng-click="vm.previousPage('pendingBids')" ng-disabled="vm.pagination.pendingBids.currentPage === 1" style="padding: 0.5rem 1rem; border: 1px solid #ddd; background: white; cursor: pointer; border-radius: 4px;">
            Previous
        </button>
        <span style="color: #666;">Page {{vm.pagination.pendingBids.currentPage}} of {{vm.getTotalPages('pendingBids')}}</span>
        <button ng-click="vm.nextPage('pendingBids')" ng-disabled="vm.pagination.pendingBids.currentPage >= vm.getTotalPages('pendingBids')" style="padding: 0.5rem 1rem; border: 1px solid #ddd; background: white; cursor: pointer; border-radius: 4px;">
            Next
        </button>
    </div>

    <h3>Active Bookings</h3>
    <select ng-model="vm.filters.bookingType" ng-change="vm.applyFilters()" style="margin-left: 10px; padding: 5px; font-size: 12px; border: 1px solid #bdc3c7; border-radius: 5px; background-color: white; cursor: pointer;">
        <option value="all">All</option>
        <option value="local">Local</option>
        <option value="outstation">Outstation</option>
    </select>
    <div class="table-responsive" style="overflow-x: auto; max-width: 1200px;">
        <table id="bookings-table" class="table table-hover" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <thead>
                <tr>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Car Name</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Bid Price</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Total Amount</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">User</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">From</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">To</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Created At</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Rental Type</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="booking in vm.getPaginatedData(vm.filteredBookings, vm.pagination.bookings) track by booking.bookingId | orderBy : '-createdAt'" style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">
                    <td>{{booking.bid.car.carName}}</td>
                    <td>{{booking.bid.bidAmount | price}}</td>
                    <td>{{vm.getTotalAmount(booking) | price}}</td>
                    <td>{{booking.bid.user.username}}</td>
                    <td>{{booking.fromTimestamp | date:'MM/dd/yyyy HH:mm'}}</td>
                    <td>{{booking.toTimestamp | date:'MM/dd/yyyy HH:mm'}}</td>
                    <td>{{booking.createdAt | date:'MM/dd/yyyy HH:mm'}}</td>
                    <td>{{booking.rentalType}}</td>
                    <td>
                        <button ng-if="vm.isBookingOver(booking) && booking.extraHourCharges === 0 && booking.extraKmCharges === 0" ng-click="vm.openAddKmModal(booking)" class="extra-charges-btn" style="font-size: 13px; background: linear-gradient(135deg, #007bff, #0056b3); color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; transition: background 0.3s, transform 0.2s;">
                            Add Additional(Km/Hr)
                        </button>
                        <span ng-if="!vm.isBookingOver(booking)">N/A</span>
                        <span ng-if="vm.isBookingOver(booking) && (booking.extraHourCharges !== 0 || booking.extraKmCharges !== 0)">Additional charges added</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="pagination" ng-if="vm.shouldShowPagination('bookings')" style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin: 1rem 0; text-align: center;">
        <button ng-click="vm.previousPage('bookings')" ng-disabled="vm.pagination.bookings.currentPage === 1" style="padding: 0.5rem 1rem; border: 1px solid #ddd; background: white; cursor: pointer; border-radius: 4px;">
            Previous
        </button>
        <span style="color: #666;">Page {{vm.pagination.bookings.currentPage}} of {{vm.getTotalPages('bookings')}}</span>
        <button ng-click="vm.nextPage('bookings')" ng-disabled="vm.pagination.bookings.currentPage >= vm.getTotalPages('bookings')" style="padding: 0.5rem 1rem; border: 1px solid #ddd; background: white; cursor: pointer; border-radius: 4px;">
            Next
        </button>
    </div>

    <h3>All Bids</h3>
    <select ng-model="vm.filters.bidStatus" ng-change="vm.applyFilters()" style="margin-left: 10px; padding: 5px; font-size: 12px; border: 1px solid #bdc3c7; border-radius: 5px; background-color: white; cursor: pointer;">
        <option value="all">All</option>
        <option value="pending">Pending</option>
        <option value="accepted">Accepted</option>
        <option value="rejected">Rejected</option>
    </select>
    <div class="table-responsive" style="overflow-x: auto; max-width: 1200px;">
        <table id="all-bids-table" class="table table-hover" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <thead>
                <tr>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Car Name</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Bid Amount</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Total Amount</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">User</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">From</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">To</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Rental Type</th>
                    <th style="background-color: #2c3e50; color: white; cursor: pointer; position: relative;">Status</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="bid in vm.getPaginatedData(vm.filteredAllBids, vm.pagination.allBids)" style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">
                    <td>{{bid.car.carName}}</td>
                    <td>{{bid.bidBaseFare | price}}</td>
                    <td>{{bid.bidAmount | price}}</td>
                    <td>{{bid.user.username}}</td>
                    <td>{{bid.fromTimestamp | date:'MM/dd/yyyy HH:mm'}}</td>
                    <td>{{bid.toTimestamp | date:'MM/dd/yyyy HH:mm'}}</td>
                    <td>{{bid.rentalType}}</td>
                    <td>{{bid.status}}</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="pagination" ng-if="vm.shouldShowPagination('allBids')" style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin: 1rem 0; text-align: center;">
        <button ng-click="vm.previousPage('allBids')" ng-disabled="vm.pagination.allBids.currentPage === 1" style="padding: 0.5rem 1rem; border: 1px solid #ddd; background: white; cursor: pointer; border-radius: 4px;">
            Previous
        </button>
        <span style="color: #666;">Page {{vm.pagination.allBids.currentPage}} of {{vm.getTotalPages('allBids')}}</span>
        <button ng-click="vm.nextPage('allBids')" ng-disabled="vm.pagination.allBids.currentPage >= vm.getTotalPages('allBids')" style="padding: 0.5rem 1rem; border: 1px solid #ddd; background: white; cursor: pointer; border-radius: 4px;">
            Next
        </button>
    </div>
</div>